var e={839:(e,t,n)=>{function o(){}n.r(t),n.d(t,{default:()=>i}),function(e){!function(e){e.use=function(e,t={}){const n=this._installedPlugins||(this._installedPlugins=[]);if(n.indexOf(e)>-1)return this;const o=[t];return o.unshift(this),"function"==typeof e.install?e.install.apply(e,o):"function"==typeof e&&e.apply(null,o),n.push(e),this}}(e)}(o);const i=o}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{n.d(o,{eP:()=>G,mq:()=>i,fR:()=>r,mt:()=>t});var e={};n.r(e),n.d(e,{checkSession:()=>L,chooseImage:()=>T,clearStorage:()=>C,getStorage:()=>x,getUserProfile:()=>O,login:()=>g,removeStorage:()=>b,request:()=>v,scanCode:()=>w,setStorage:()=>_,uploadFile:()=>E});var t,i,r,a=n(839);function s(e){return[null,e]}function u(e){return[e,void 0]}function c(){return["wx","ali","baidu","qq","tt","jd","ks","qa_webview","qa_ux","Mpx","Taro","uni"].reduce(((e,t)=>(e[`__authing_move_src_mode_${t}__`]=t,e)),{})}function p(e){console.error&&console.error(`[AuthingMove/api-proxy error in "wx"]:\n ${e}`)}function d(){}function l(e,t={},n={}){let o={};return Object.keys(e).forEach((n=>{const i=t.hasOwnProperty(n)?t[n]:n;i&&(o[i]=e[n])})),o=Object.assign({},o,n),o}function h(){return wx}!function(e){e.wx="wx",e.tt="tt"}(t||(t={})),function(e){e.wechat_mini_program_code="wechat_mini_program_code",e.douyin_mini_program_code="douyin_mini_program_code"}(i||(i={})),function(e){e.wechat_mini_program_code_and_phone="wechat_mini_program_code_and_phone",e.douyin_mini_program_code_and_phone="douyin_mini_program_code_and_phone"}(r||(r={}));const f=h();function g(e={}){return f.login(e)}const y=h();function v(e={}){return y.request(e)}const m=h();function w(e={}){return m.scanCode(e)}const P=h();function _(e={}){const t=l(e,{},{encrypt:!1});return P.setStorage(t)}function x(e={}){const t=l(e,{},{encrypt:!1});return P.getStorage(t)}function b(e={}){return P.removeStorage(e)}function C(e={}){return P.clearStorage(e)}const S=h();function T(e={}){return S.chooseMedia(e)}const k=h();function E(e={}){return k.uploadFile(e)}const I=h();function O(e={}){return I.getUserProfile(e)}const D=h();function L(e={}){return D.checkSession(e)}const R=c();const A=h();a.default.use((function(t,n={}){const{custom:o={}}=n,i=function(t){const n=h(),o=Object.create(null);Object.keys(e).forEach((t=>{o[t]=n[t]||e[t]}));const i=Object.create(null);return Object.keys(o).forEach((r=>{"function"==typeof o[r]?i[r]=(...o)=>{let i=t.from;const a=t.to;o.length&&(i=o.pop(),"string"==typeof i&&R[i]||(o.push(i),i=t.from));const s=function(e="",t=""){return`${R[`__authing_move_src_mode_${e}__`]}_${t}`}(i,a);return t.custom[s]&&t.custom[s][r]?t.custom[s][r].apply(this,o):e[r]?e[r].apply(this,o):n[r]?n[r].apply(this,o):void p(`"${r}" method does not exist in the current context`)}:i[r]=o[r]})),i}({from:"wx",to:"wx",custom:o}),r=Object.assign({},i,function(e){const t=c();return Object.keys(e).reduce(((n,o)=>("function"!=typeof e[o]||(n[o]=function(...n){if(function(e){return/^get\w*Manager$/.test(e)||/^create\w*Context$/.test(e)||/^(on|off)/.test(e)||/\w+Sync$/.test(e)}(o))return e[o].apply(e,n);n[0]&&!t[n[0]]||n.unshift({success:d,fail:d});const i=n[0];let r;const a=new Promise(((t,a)=>{const s=i.success,u=i.fail;i.success=function(e){s&&s.call(this,e),t(e)},i.fail=function(e){u&&u.call(this,e),a(e)},r=e[o].apply(A,n)}));return a.__returned=r,a}),n)),{})}(i));Object.keys(r).forEach((e=>{try{if("function"!=typeof r[e])return void(t[e]=r[e]);t[e]=(...n)=>r[e].apply(t,n)}catch(n){p(`Call ${t}.${e} error:`+JSON.stringify(n))}}))}));var N=function(){function e(){}return e.prototype.get=function(e){return a.default.getStorage({key:e})},e.prototype.set=function(e,t){return a.default.setStorage({key:e,data:t})},e.prototype.remove=function(e){return a.default.removeStorage({key:e})},e}();var q,M=function(){return M=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},M.apply(this,arguments)};function j(e){return t=this,n=void 0,i=function(){var t,n,o,i;return function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=Object.assign({},e,{header:M(M({},e.header),{"x-authing-request-from":"sdk-miniapp","x-authing-sdk-version":"5.1.20"})}),[4,a.default.request(t)];case 1:switch(n=r.sent().data,o=function(e,t){for(var n=[{test:/(\/api\/v3\/system)$/,validate:function(){return!(!t.rsa&&!t.sm2)}},{test:/(\/oidc\/token)$/,validate:function(){return!(!t.access_token&&!t.id_token)}},{test:/(\/oidc\/token\/revocation)$/,validate:function(){return!0}}],o=0;o<n.length;o++){var i=e.match(n[o].test);if(i&&i[0])return n[o].validate()?q.INTERCEPTED_SUCCESS:q.INTERCEPTED_ERROR}return 200===t.statusCode?q.NOT_INTERCEPTED_SUCCESS:q.NOT_INTERCEPTED_ERROR}(e.url,n),o){case q.NOT_INTERCEPTED_SUCCESS:return[2,s(n.data||n)];case q.INTERCEPTED_SUCCESS:return[2,s(n)];default:return[2,u(n)]}return[3,3];case 2:return i=r.sent(),[2,u({message:JSON.stringify(i)})];case 3:return[2]}}))},new((o=void 0)||(o=Promise))((function(e,r){function a(e){try{u(i.next(e))}catch(e){r(e)}}function s(e){try{u(i.throw(e))}catch(e){r(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(a,s)}u((i=i.apply(t,n||[])).next())}));var t,n,o,i}!function(e){e[e.NOT_INTERCEPTED_SUCCESS=0]="NOT_INTERCEPTED_SUCCESS",e[e.NOT_INTERCEPTED_ERROR=1]="NOT_INTERCEPTED_ERROR",e[e.INTERCEPTED_SUCCESS=2]="INTERCEPTED_SUCCESS",e[e.INTERCEPTED_ERROR=3]="INTERCEPTED_ERROR"}(q||(q={}));var U=n(839).default;function B(e){return["authing",e,"login-state"].join(":")}function z(e,t){return["authing",e,(t||"wx")+"-login-code"].join(":")}var $=function(){return $=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},$.apply(this,arguments)},F=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{u(o.next(e))}catch(e){r(e)}}function s(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))},J=function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},K=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)a.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return a},G=function(){function e(e){this.options=$($({},e),{host:e.host||"https://core.authing.cn",platform:e.platform||("undefined"!=typeof tt&&void 0!==tt.getSystemInfo?t.tt:(void 0!==U&&U.getSystemInfo,t.wx))||"wx"}),this.storage=new N,this.encryptFunction=e.encryptFunction,this.resetPlatformLoginCode()}return e.prototype.getLoginState=function(){return F(this,void 0,void 0,(function(){var e,t,n;return J(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.storage.get(B(this.options.appId))];case 1:return e=o.sent(),(t=e.data).expires_at>Date.now()?[2,s(t)]:[2,u({message:"login state has expired, please login again"})];case 2:return n=o.sent(),[2,u({message:JSON.stringify(n)})];case 3:return[2]}}))}))},e.prototype.clearLoginState=function(){return F(this,void 0,void 0,(function(){var e;return J(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.storage.remove(B(this.options.appId))];case 1:return t.sent(),[2,s(!0)];case 2:return e=t.sent(),[2,u({message:JSON.stringify(e)})];case 3:return[2]}}))}))},e.prototype.saveLoginState=function(e){return F(this,void 0,void 0,(function(){var t;return J(this,(function(n){switch(n.label){case 0:return t=$($({},e),{expires_at:1e3*e.expires_in+Date.now()}),[4,this.storage.set(B(this.options.appId),t)];case 1:return n.sent(),[2,t]}}))}))},e.prototype.getPublicKey=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i;return J(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,j({method:"GET",url:this.options.host+"/api/v3/system"})];case 1:return t=K.apply(void 0,[r.sent(),2]),n=t[0],o=t[1],n?[2,u(n)]:[2,s(o[e].publicKey)];case 2:return i=r.sent(),[2,u({message:"get public key error: "+JSON.stringify(i)})];case 3:return[2]}}))}))},e.prototype.getDefaultLoginByCodeConnection=function(){var e=i.wechat_mini_program_code;return this.options.platform===t.tt&&(e=i.douyin_mini_program_code),e},e.prototype.getDefaultLoginByPhoneCodeConnection=function(){var e=r.wechat_mini_program_code_and_phone;return this.options.platform===t.tt&&(e=r.douyin_mini_program_code_and_phone),e},e.prototype.getCachedPlatformLoginCode=function(){return F(this,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.storage.get(z(this.options.appId,this.options.platform))];case 1:return[2,e.sent().data];case 2:return e.sent(),[2,""];case 3:return[2]}}))}))},e.prototype.cachePlatformLoginCode=function(e){return F(this,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.storage.set(z(this.options.appId,this.options.platform),e)];case 1:return t.sent(),[2,e];case 2:return t.sent(),[2,""];case 3:return[2]}}))}))},e.prototype.resetPlatformLoginCode=function(){return F(this,void 0,void 0,(function(){var e,t=this;return J(this,(function(n){switch(n.label){case 0:e=function(){return F(t,void 0,void 0,(function(){var e;return J(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,a.default.login()];case 1:return e=t.sent(),[4,this.cachePlatformLoginCode(e.code)];case 2:return t.sent(),[2,!0];case 3:return t.sent(),[2,!1];case 4:return[2]}}))}))},n.label=1;case 1:return n.trys.push([1,,3,5]),this.storage.remove(z(this.options.appId,this.options.platform)),[4,e()];case 2:return n.sent(),[3,5];case 3:return[4,this.getCachedPlatformLoginCode()];case 4:return[2,n.sent()];case 5:return[2]}}))}))},e.prototype.getLoginCode=function(){return F(this,void 0,void 0,(function(){return J(this,(function(e){switch(e.label){case 0:return[4,this.resetPlatformLoginCode()];case 1:return[2,e.sent()]}}))}))},e.prototype.loginByCode=function(e){return F(this,void 0,void 0,(function(){var n,o,i,r,a,c,p,d,l;return J(this,(function(h){switch(h.label){case 0:return[4,this.getLoginState()];case 1:return n=K.apply(void 0,[h.sent(),2]),(o=n[1])&&o.expires_at>Date.now()?[2,s(o)]:(i=e.extIdpConnidentifier,r=e.connection,a=e.wechatMiniProgramCodePayload,c=e.douyinMiniProgramCodePayload,p=e.options,[4,this.resetPlatformLoginCode()]);case 2:if(!(d=h.sent()))return[2,u({message:"get wx login code error"})];switch(l={connection:r||this.getDefaultLoginByCodeConnection(),extIdpConnidentifier:i,wechatMiniProgramCodePayload:t.wx==this.options.platform?{encryptedData:(null==a?void 0:a.encryptedData)||"",iv:(null==a?void 0:a.iv)||"",code:d}:void 0,douyinMiniProgramCodePayload:t.tt==this.options.platform?{encryptedData:(null==c?void 0:c.encryptedData)||"",iv:(null==c?void 0:c.iv)||"",code:d}:void 0,options:p},this.options.platform){case t.wx:l.wechatMiniProgramCodePayload={encryptedData:(null==a?void 0:a.encryptedData)||"",iv:(null==a?void 0:a.iv)||"",code:d};break;case t.tt:l.douyinMiniProgramCodePayload={encryptedData:(null==c?void 0:c.encryptedData)||"",iv:(null==c?void 0:c.iv)||"",code:d}}return[4,this.login(l,"code")];case 3:return[2,h.sent()]}}))}))},e.prototype.loginByPassword=function(e){var t,n;return F(this,void 0,void 0,(function(){var o,i,r,a;return J(this,(function(s){switch(s.label){case 0:return(null===(t=e.options)||void 0===t?void 0:t.passwordEncryptType)&&"none"!==(null===(n=e.options)||void 0===n?void 0:n.passwordEncryptType)?this.encryptFunction?[4,this.getPublicKey(e.options.passwordEncryptType)]:[2,u({message:'encryptFunction is required, if passwordEncryptType is not "none"'})]:[3,2];case 1:if(o=K.apply(void 0,[s.sent(),2]),i=o[0],r=o[1],i)return[2,u(i)];if("string"!=typeof r)return[2,u({message:"publicKey of "+e.options.passwordEncryptType+" is not a string, please contact the administrator"})];e.passwordPayload.password=this.encryptFunction(e.passwordPayload.password,r),s.label=2;case 2:return a=$($({},e),{connection:"PASSWORD"}),[4,this.login(a,"password")];case 3:return[2,s.sent()]}}))}))},e.prototype.loginByPassCode=function(e){return F(this,void 0,void 0,(function(){var t;return J(this,(function(n){switch(n.label){case 0:return e.passCodePayload.phone&&(e.passCodePayload.phoneCountryCode=e.passCodePayload.phoneCountryCode||"+86"),t=$($({},e),{connection:"PASSCODE"}),[4,this.login(t,"passCode")];case 1:return[2,n.sent()]}}))}))},e.prototype.loginByPhone=function(e){var n,o;return F(this,void 0,void 0,(function(){var i,r,a,c,p,d,l,h,f,g,y;return J(this,(function(v){switch(v.label){case 0:return[4,this.getLoginState()];case 1:if(i=K.apply(void 0,[v.sent(),2]),(r=i[1])&&r.expires_at>Date.now())return[2,s(r)];switch(a=e.extIdpConnidentifier,c=e.wechatMiniProgramCodeAndPhonePayload,p=e.miniProgramCodeAndPhonePayload,d=e.options,l={extIdpConnidentifier:a,wechatMiniProgramCodeAndPhonePayload:void 0,douyinMiniProgramCodeAndPhonePayload:void 0,options:d,connection:this.getDefaultLoginByPhoneCodeConnection()},this.options.platform){case t.wx:return[3,2];case t.tt:return[3,4]}return[3,6];case 2:return(h=(null==c?void 0:c.wxPhoneInfo)||(null==p?void 0:p.wxPhoneInfo))&&h.code?[4,this.resetPlatformLoginCode()]:[2,u({message:"wxPhoneInfo.code is required"})];case 3:return(f=v.sent())?(l={connection:this.getDefaultLoginByPhoneCodeConnection(),extIdpConnidentifier:a,wechatMiniProgramCodeAndPhonePayload:{wxPhoneInfo:h,wxLoginInfo:{encryptedData:(null===(n=null==c?void 0:c.wxLoginInfo)||void 0===n?void 0:n.encryptedData)||"",iv:(null===(o=null==c?void 0:c.wxLoginInfo)||void 0===o?void 0:o.iv)||"",code:f}},options:d},[3,6]):[2,u({message:"get wx login code error"})];case 4:return(g=null==p?void 0:p.phoneParams)?[4,this.resetPlatformLoginCode()]:[2,u({message:"loginParams is required"})];case 5:return(y=v.sent())?(l={connection:this.getDefaultLoginByPhoneCodeConnection(),extIdpConnidentifier:a,douyinMiniProgramCodeAndPhonePayload:{loginParams:{encryptedData:"",iv:"",code:y},phoneParams:{encryptedData:(null==g?void 0:g.encryptedData)||"",iv:(null==g?void 0:g.iv)||""}},options:d},[3,6]):[2,u({message:"get tt login params error ,please use the miniProgramCodeAndPhonePayload"})];case 6:return[4,this.login(l,"phone")];case 7:return[2,v.sent()]}}))}))},e.prototype.logout=function(){return F(this,void 0,void 0,(function(){var e,t,n,o,i,r,a,c;return J(this,(function(p){switch(p.label){case 0:return[4,this.getLoginState()];case 1:return e=K.apply(void 0,[p.sent(),2]),t=e[0],n=e[1],t?[4,this.clearLoginState()]:[3,3];case 2:case 4:case 7:return p.sent(),[2,s(!0)];case 3:return i=(o=n).access_token,r=o.expires_at,!i||r<Date.now()?[4,this.clearLoginState()]:[3,5];case 5:return[4,j({method:"POST",url:this.options.host+"/oidc/token/revocation",data:{client_id:this.options.appId,token:i},header:{"content-type":"application/x-www-form-urlencoded"}})];case 6:return a=K.apply(void 0,[p.sent(),1]),(c=a[0])?[2,u(c)]:[4,this.clearLoginState()]}}))}))},e.prototype.sendSms=function(e){return F(this,void 0,void 0,(function(){var t,n,o;return J(this,(function(i){switch(i.label){case 0:return e.phoneCountryCode=e.phoneCountryCode||"+86",[4,j({method:"POST",url:this.options.host+"/api/v3/send-sms",data:e,header:{"x-authing-userpool-id":this.options.userPoolId}})];case 1:return t=K.apply(void 0,[i.sent(),2]),n=t[0],o=t[1],n?[2,u(n)]:[2,s(o)]}}))}))},e.prototype.sendEmailCode=function(e){return F(this,void 0,void 0,(function(){var t,n,o;return J(this,(function(i){switch(i.label){case 0:return[4,j({method:"POST",url:this.options.host+"/api/v3/send-email",data:e,header:{"x-authing-userpool-id":this.options.userPoolId}})];case 1:return t=K.apply(void 0,[i.sent(),2]),n=t[0],o=t[1],n?[2,u(n)]:[2,s(o)]}}))}))},e.prototype.login=function(e,t){return F(this,void 0,void 0,(function(){var n,o,i,r;return J(this,(function(a){switch(a.label){case 0:return n={code:"/api/v3/signin-by-mobile",phone:"/api/v3/signin-by-mobile",password:"/api/v3/signin",passCode:"/api/v3/signin"},[4,j({method:"POST",url:this.options.host+n[t],data:e,header:{"x-authing-app-id":this.options.appId}})];case 1:return o=K.apply(void 0,[a.sent(),2]),i=o[0],r=o[1],i?[2,u(i)]:r.access_token||r.id_token?[4,this.saveLoginState(r)]:[3,3];case 2:return[2,s(a.sent())];case 3:return[4,this.clearLoginState()];case 4:return a.sent(),[2,u(r)]}}))}))},e.prototype.refreshToken=function(){return F(this,void 0,void 0,(function(){var e,t,n,o,i,r,a,c,p,d;return J(this,(function(l){switch(l.label){case 0:return[4,this.getLoginState()];case 1:return e=K.apply(void 0,[l.sent(),2]),t=e[0],n=e[1],t?[2,u({message:"refresh_token has expired, please login again"})]:(i=(o=n).refresh_token,r=o.expires_at,i?r<Date.now()?[2,u({message:"refresh_token has expired, please login again"})]:(a={grant_type:"refresh_token",redirect_uri:"",refresh_token:i},[4,j({method:"POST",url:this.options.host+"/oidc/token",data:a,header:{"content-type":"application/x-www-form-urlencoded","x-authing-app-id":this.options.appId}})]):[2,u({message:"refresh_token must not be empty"})]);case 2:return c=K.apply(void 0,[l.sent(),2]),p=c[0],d=c[1],p?[2,u(p)]:[4,this.saveLoginState(d)];case 3:return[2,s(l.sent())]}}))}))},e.prototype.updatePassword=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p,d,l,h;return J(this,(function(f){switch(f.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[f.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:e.passwordEncryptType&&"none"!==e.passwordEncryptType?this.encryptFunction?[4,this.getPublicKey(e.passwordEncryptType)]:[2,u({message:'encryptFunction is required, if passwordEncryptType is not "none"'})]:[3,3]);case 2:if(a=K.apply(void 0,[f.sent(),2]),c=a[0],p=a[1],c)return[2,u(c)];e.newPassword=this.encryptFunction(e.newPassword,p),f.label=3;case 3:return[4,j({method:"POST",url:this.options.host+"/api/v3/update-password",data:e,header:{"x-authing-userpool-id":this.options.userPoolId,Authorization:r}})];case 4:return d=K.apply(void 0,[f.sent(),2]),l=d[0],h=d[1],l?[2,u(l)]:[2,s(h)]}}))}))},e.prototype.getUserInfo=function(e){return void 0===e&&(e={withCustomData:!1,withDepartmentIds:!1,withIdentities:!1}),F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"GET",url:this.options.host+"/api/v3/get-profile",header:{"x-authing-userpool-id":this.options.userPoolId,Authorization:r},data:e})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.updateAvatar=function(){return F(this,void 0,void 0,(function(){var e,t,n,o;return J(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,a.default.chooseImage({count:1,sourceType:["album","camera"],sizeType:["original"]})];case 1:return e=i.sent(),[4,a.default.uploadFile({url:this.options.host+"/api/v2/upload?folder=avatar",name:"file",filePath:e.tempFiles[0].tempFilePath})];case 2:return t=i.sent(),n=JSON.parse(t.data),[4,this.updateUserInfo({photo:n.data.url})];case 3:return i.sent(),[2,s(n)];case 4:return o=i.sent(),[2,u({message:JSON.stringify(o)})];case 5:return[2]}}))}))},e.prototype.updateUserInfo=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/update-profile",data:e,header:{"x-authing-userpool-id":this.options.userPoolId,Authorization:r}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.bindWxByCode=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p,d,l;return J(this,(function(h){switch(h.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[h.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,this.resetPlatformLoginCode()]);case 2:return(a=h.sent())?(c=$({code:a},e),[4,j({method:"POST",url:this.options.host+"/connections/social/wechat-miniprogram/bind",data:c,header:{"x-authing-userpool-id":this.options.userPoolId,Authorization:r}})]):[2,u({message:"get wx login code error"})];case 3:return p=K.apply(void 0,[h.sent(),2]),d=p[0],l=p[1],d?[2,u(d)]:[2,s(l)]}}))}))},e.prototype.bindPlatformByCode=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p,d,l;return J(this,(function(h){switch(h.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[h.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,this.resetPlatformLoginCode()]);case 2:return(a=h.sent())?(c=$({code:a},e),[4,j({method:"POST",url:""+this.options.host+this.getApiUrlMapping("bindPlatformByCode"),data:c,header:{"x-authing-userpool-id":this.options.userPoolId,Authorization:r}})]):[2,u({message:"get wx login code error"})];case 3:return p=K.apply(void 0,[h.sent(),2]),d=p[0],l=p[1],d?[2,u(d)]:[2,s(l)]}}))}))},e.prototype.bindEmail=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/bind-email",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.updateEmailRequest=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/verify-update-email-request",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.updateEmail=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/update-email",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.bindPhone=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/bind-phone",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.updatePhoneRequest=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/verify-update-phone-request",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.updatePhone=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/update-phone",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.deleteAccountRequest=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/verify-delete-account-request",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.deleteAccount=function(e){return F(this,void 0,void 0,(function(){var t,n,o,i,r,a,c,p;return J(this,(function(d){switch(d.label){case 0:return[4,this.getLoginState()];case 1:return t=K.apply(void 0,[d.sent(),2]),n=t[0],o=t[1],n?[2,u({message:"Token has expired, please login again"})]:(r=(i=o).access_token,i.expires_at<Date.now()?[2,u({message:"Token has expired, please login again"})]:[4,j({method:"POST",url:this.options.host+"/api/v3/delete-account",data:e,header:{Authorization:r,"x-authing-userpool-id":this.options.userPoolId}})]);case 2:return a=K.apply(void 0,[d.sent(),2]),c=a[0],p=a[1],c?[2,u(c)]:[2,s(p)]}}))}))},e.prototype.getPhone=function(e){return F(this,void 0,void 0,(function(){var n,o,i,r,a;return J(this,(function(c){switch(c.label){case 0:switch(n=$({},e),this.options.platform){case t.wx:return[3,1];case t.tt:return[3,2]}return[3,4];case 1:return n.code&&n.extIdpConnidentifier?[3,4]:[2,u({message:"code or extIdpConnidentifier is required"})];case 2:return n.extIdpConnidentifier?[4,this.resetPlatformLoginCode()]:[2,u({message:"extIdpConnidentifier is required"})];case 3:return o=c.sent(),n=$($({},n),{code:o}),[3,4];case 4:return[4,j({method:"POST",url:""+this.options.host+this.getApiUrlMapping("getPhone"),data:n,header:{"x-authing-userpool-id":this.options.userPoolId}})];case 5:return i=K.apply(void 0,[c.sent(),2]),r=i[0],a=i[1],r?[2,u(r)]:a.phone_info?[2,s(a.phone_info)]:[2,u(a)]}}))}))},e.prototype.decryptData=function(e){return F(this,void 0,void 0,(function(){var t,n,o;return J(this,(function(i){switch(i.label){case 0:return[4,j({method:"POST",url:""+this.options.host+this.getApiUrlMapping("decryptData"),data:e,header:{"x-authing-userpool-id":this.options.userPoolId}})];case 1:return t=K.apply(void 0,[i.sent(),2]),n=t[0],o=t[1],n?[2,u(n)]:[2,s(o)]}}))}))},e.prototype.getApiUrlMapping=function(e){var n="";switch(e){case"getPhone":n="/api/v3/get-wechat-miniprogram-phone",this.options.platform===t.tt&&(n="/api/v3/decrypt-douyin-miniprogram-phone");break;case"bindPlatformByCode":n="/connections/social/wechat-miniprogram/bind",this.options.platform===t.tt&&(n="/connections/social/douyin-miniprogram/bind");break;case"decryptData":n="/api/v3/decrypt-wechat-miniprogram-data",this.options.platform===t.tt&&(n="/api/v3/decrypt-douyin-miniprogram-data");break;case"getAccessTokenInfo":n="/api/v3/get-wechat-access-token-info",this.options.platform===t.tt&&(n="/api/v3/get-douyin-access-token-info")}return n},e}()})();var i=o.eP,r=o.mq,a=o.fR,s=o.mt;export{i as Authing,r as LoginByCodeConnection,a as LoginByPhoneCodeConnection,s as PlatformsMenu};